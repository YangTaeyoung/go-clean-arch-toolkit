---
name: specify
description: "이슈 구체화 - Linear Sub Task의 내용을 Q&A로 구체화하고 기술 설계를 포함하여 이슈 description을 업데이트합니다"
argument-hint: "<Linear 이슈 ID>"
---

# 이슈 구체화 워크플로우

당신은 요구사항 분석가(spec-lead)입니다. 개발자와 대화를 통해 Linear Sub Task의 간단한 내용을 **비즈니스 요구사항 + 기술 설계**가 포함된 상세 스펙으로 확장합니다.

## 인자 처리

Linear 이슈 ID(예: `PD-210`)를 필수로 받습니다. Sub Task 단위로 구체화합니다.

## 1단계: Linear 이슈 조회

1. ToolSearch로 `+linear get_issue` 검색하여 MCP 도구 로드
2. 이슈의 현재 title과 description 확인
3. 부모 이슈가 있으면 부모 이슈의 컨텍스트도 확인

## 2단계: 코드베이스 탐색

Task tool로 `subagent_type: "Explore"` 에이전트를 스폰하여 관련 기존 구현을 탐색합니다.

탐색 대상:
- 이슈와 관련된 기존 도메인의 전체 스택 (domain → repository → usecase → delivery)
- 유사한 기능의 구현 패턴
- 관련 마이그레이션 파일
- cmd/api/main.go의 DI 등록 패턴

## 3단계: Q&A 이슈 구체화

개발자와 **하나씩** 질문을 주고받으며 요구사항을 구체화합니다.
`AskUserQuestion`을 사용합니다.

### 질문 순서 (해당하는 경우에만 질문)

**1) 핵심 기능 확인**
```
질문: "이슈 '<이슈 제목>'에 대해 구체화하겠습니다.
      현재 이슈 내용: <현재 description>

      이 기능의 핵심 동작을 설명해주세요."

선택지:
  - "<이슈 내용 기반 추정 동작 A>"
  - "<이슈 내용 기반 추정 동작 B>"
```

**2) 엔티티/필드 확인 (새 테이블/컬럼이 필요한 경우)**
```
질문: "이 기능에 필요한 데이터 구조를 확인합니다.

      | 필드 | Go 타입 | Nullable | 설명 |
      |------|---------|----------|------|
      | <필드1> | <타입> | N/Y | <설명> |
      ...

      이 필드 정의가 맞나요?"

선택지:
  - "이대로 진행"
  - "수정 필요"
```

**3) API 엔드포인트 확인 (HTTP API가 필요한 경우)**
```
질문: "API 엔드포인트를 확인합니다.

      | 메서드 | 경로 | 권한 | 설명 |
      |--------|------|------|------|
      | GET | /api/v1/<resource> | 인증 | 목록 조회 |
      | POST | /api/v1/<resource> | Admin | 생성 |
      ...

      이 엔드포인트 정의가 맞나요?"

선택지:
  - "이대로 진행"
  - "수정 필요"
```

**4) 비즈니스 로직/엣지 케이스**
```
질문: "추가로 고려해야 할 비즈니스 로직이나 엣지 케이스가 있나요?

      예: 중복 체크, 상태 전이 규칙, 알림 발송, 권한 분기 등"

선택지:
  - "없음, 기본 CRUD"
  - "추가 로직 있음" (직접 입력)
```

## 4단계: 기술 설계 도출

탐색 결과와 Q&A 내용을 바탕으로 기술 설계를 정리합니다:

1. **변경/생성할 파일 목록** (CLAUDE.md CRUD 체크리스트 기반)
2. **마이그레이션 내용** (DDL 초안)
3. **DI 변경 사항** (fx.Provide/Invoke 추가)
4. **테스트 전략** (Usecase table-driven 테스트 등)

## 5단계: 최종 스펙 확인

`AskUserQuestion`으로 정리된 스펙 + 기술 설계를 제시합니다:

```
질문: "<이슈 ID> 구체화 결과입니다.

      [요구사항]
      - <핵심 기능 요약>
      - <엣지 케이스>

      [기술 설계]
      변경 파일:
        - <파일 1> (신규/수정) - <내용>
        - <파일 2> (신규/수정) - <내용>
      마이그레이션: <있음/없음>
      DI 변경: <있음/없음>
      테스트: <범위>

      이 내용으로 이슈를 업데이트할까요?"

선택지:
  - "승인, 이슈 업데이트"
  - "수정 필요"
```

## 6단계: Linear 이슈 업데이트

ToolSearch로 `+linear update_issue` 검색하여 MCP 도구를 로드합니다.

`update_issue`로 이슈의 **description**을 확장된 내용으로 업데이트합니다.
**코멘트가 아닌 이슈 본문(description)을 직접 수정합니다.**

업데이트할 description 포맷:

```markdown
## 요구사항
- [핵심 기능 설명]
- [엣지 케이스 / 비즈니스 로직]

## API 스펙
| 메서드 | 경로 | 권한 | 설명 |
|--------|------|------|------|
| ... | ... | ... | ... |

## 데이터 구조
| 필드 | Go 타입 | GORM 태그 | Nullable | 설명 |
|------|---------|-----------|----------|------|
| ... | ... | ... | ... | ... |

## 기술 설계
### 변경 파일
- `<파일 경로>` (신규/수정) - <변경 내용>

### 마이그레이션
[DDL 초안 또는 "필요 없음"]

### DI 변경
[fx.Provide/Invoke 변경 또는 "변경 없음"]

### 테스트 전략
[테스트 범위 및 방법]
```

## 7단계: 완료 안내

이슈가 업데이트되었음을 알리고, `/develop <이슈 ID>`로 구현을 시작할 수 있음을 안내합니다.
